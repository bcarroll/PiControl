{%extends "base.html"%}
{%block title%}Nodes{% endblock %}

{%block body%}
<h1 class="page-header" id="page-header" title="Raspberry Pi devices (running PiControl) on the network from which we have received a UDP Beacon"><i class="fas fa-share-alt"></i> Discovered PiControl Nodes</h1>
<table id="nodes" class="table table-hover" style="width:100%;" width="100%">
    <tr>
        <th>IP Address</th>
        <th>Hostname</th>
        <th>Model (Revision)</th>
        <th>Last Checkin</th>
    </tr>
</table>
<script>
    get_nodes();

    function get_nodes(){
        $.get('/nodes/refresh', function(result){
            for (var key in result){
                id = key.replace(/\./g, '');
                link = 'https://' + key + ':31415/';
                if ( $('#' + id).length ){
                    $('#' + id + '_ipaddress').text('<a href="' + link + '" class="node">' + key + '</a>');
                    $('#' + id + '_hostname').text('<a href="' + link + '" class="node">' + result[key].hostname + '</a>');
                    $('#' + id + '_model').text('<a href="' + link + '" class="node">' + result[key].model + ' (' + result[key].revision + ')</a>');
                    $('#' + id + '_last_checkin').text('<a href="' + link + '" class="node">' + result[key].last_checkin + '</a>');
                } else {
                    $('#nodes tr:last').after(
                            '<tr id="' + id + '">'
                            + '<td id="' + id + '_ipaddress"><a href="' + link + '" class="node">' + key + '</a></td>'
                            + '<td id="' + id + '_hostname"><a href="' + link + '" class="node">' + result[key].hostname + '</a></td>'
                            + '<td id="' + id + '_model"><a href="' + link + '" class="node">' + result[key].model + ' (' + result[key].revision + ')</a></td>'
                            + '<td id="' + id + '_last_checkin"><a href="' + link + '" class="node">' + result[key].last_checkin + '</a></td>'
                            + '</tr>'
                        );
                }
            }
        });
    }

    setInterval(get_nodes,5000);
</script>
{%endblock%}
